# Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

## Ð‘Ð°Ð·Ð¾Ð²Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

### 1. ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» Ñ IP-Ð°Ð´Ñ€ÐµÑÐ°Ð¼Ð¸ (Ð¿Ð¾ Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ð½Ð° ÑÑ‚Ñ€Ð¾ÐºÑƒ):

```bash
cat > my_ips.txt << EOF
192.168.1.1
10.0.0.5
172.16.0.100
203.0.113.42
EOF
```

Ð˜Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…:

```bash
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ 70K IP Ñ Ñ€Ð°Ð·Ñ€ÐµÐ¶ÐµÐ½Ð½Ñ‹Ð¼ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸ÐµÐ¼ (Ñ€ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹)
python3 generate_test_data.py -n 70000 -o test_70k.txt --sparse
```

### 2. Ð—Ð°Ð¿ÑƒÑÐº Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ð¸

**Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ - Ð¶Ð°Ð´Ð½Ñ‹Ð¹ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**

```bash
python3 ip_aggregator.py my_ips.txt -o output_rules.txt -m greedy --max-entries 2000
```

**ÐŸÐ»Ð¾Ñ‚Ð½Ð¾ÑÑ‚Ð½Ð¾-Ð¾Ñ€Ð¸ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ (Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€ÐµÐ¶ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…):**

```bash
python3 ip_aggregator.py my_ips.txt -o output_rules.txt -m density --max-entries 2000
```

**ILP Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ (Ð´Ð»Ñ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°, PuLP ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸):**

```bash
python3 ip_aggregator.py my_ips.txt -o output_rules.txt -m ilp --solver cbc --max-entries 2000
```

*ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: PuLP Ð±ÑƒÐ´ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð° `ilp`, ÐµÑÐ»Ð¸ Ð¾Ð½ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½.*

### 3. ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²

```bash
# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð°Ð²Ð¸Ð»
cat output_rules.txt

# Ð¡ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼Ð¸ Ð² JSON
python3 ip_aggregator.py my_ips.txt -o output_rules.txt -m greedy --json
```

## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð´Ð»Ñ 70K IP

```bash
# Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
python3 generate_test_data.py -n 70000 -o test_70k.txt --sparse

# ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ Ð¶Ð°Ð´Ð½Ñ‹Ð¼ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¾Ð¼
python3 ip_aggregator.py test_70k.txt -o rules.txt -m greedy --max-entries 2000 --metrics
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- Ð’Ñ€ÐµÐ¼Ñ: <1 ÑÐµÐºÑƒÐ½Ð´Ð°
- ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°: ~2000
- Over-blocking: ~1-2M IP
- Expansion Factor: ~1.5-3.0

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ (ILP)

```bash
# Ð—Ð°Ð¿ÑƒÑÐº ILP Ñ€ÐµÑˆÐµÐ½Ð¸Ñ (PuLP ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸)
python3 ip_aggregator.py test_70k.txt -o rules_optimal.txt -m ilp --solver cbc --max-entries 2000
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- Ð’Ñ€ÐµÐ¼Ñ: 1-30 Ð¼Ð¸Ð½ÑƒÑ‚
- ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°: ~2000
- Over-blocking: Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ð¹
- Expansion Factor: ~1.2-2.0

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ð±Ð»Ð¾ÐºÐ°

```bash
# ÐÐµ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð±Ð»Ð¾ÐºÐ¸ ÐºÑ€ÑƒÐ¿Ð½ÐµÐµ /20
python3 ip_aggregator.py my_ips.txt -o output.txt -m greedy --max-prefix 20
```

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 4: Ð Ð°Ð·Ð½Ñ‹Ðµ Ñ†ÐµÐ»ÐµÐ²Ñ‹Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»

```bash
# Ð¡Ð¶Ð°Ñ‚ÑŒ Ð´Ð¾ 1000 Ð¿Ñ€Ð°Ð²Ð¸Ð»
python3 ip_aggregator.py my_ips.txt -o output.txt -m greedy --max-entries 1000

# Ð¡Ð¶Ð°Ñ‚ÑŒ Ð´Ð¾ 5000 Ð¿Ñ€Ð°Ð²Ð¸Ð»
python3 ip_aggregator.py my_ips.txt -o output.txt -m greedy --max-entries 5000
```

## Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð²

| ÐœÐµÑ‚Ð¾Ð´ | Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ | ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ | Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ |
|-------|----------|----------|--------------|
| `greedy` | âš¡ ÐžÑ‡ÐµÐ½ÑŒ Ð±Ñ‹ÑÑ‚Ñ€Ð¾ | â­â­â­ Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾ | Ð”Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ð° ÑÐ»ÑƒÑ‡Ð°ÐµÐ² |
| `density` | âš¡ Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ | â­â­â­â­ ÐžÑ‡ÐµÐ½ÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ | Ð”Ð»Ñ Ñ€Ð°Ð·Ñ€ÐµÐ¶ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… |
| `ilp` | ðŸŒ ÐœÐµÐ´Ð»ÐµÐ½Ð½Ð¾ | â­â­â­â­â­ ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ | ÐšÐ¾Ð³Ð´Ð° Ð½ÑƒÐ¶ÐµÐ½ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ over-blocking |

## Ð˜Ð½Ñ‚ÐµÑ€Ð¿Ñ€ÐµÑ‚Ð°Ñ†Ð¸Ñ Ð¼ÐµÑ‚Ñ€Ð¸Ðº

- **Expansion Factor**: Ð˜Ð´ÐµÐ°Ð» = 1.0. Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ 2.0 Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ð² 2 Ñ€Ð°Ð·Ð° Ð±Ð¾Ð»ÑŒÑˆÐµ IP, Ñ‡ÐµÐ¼ Ñ†ÐµÐ»ÐµÐ²Ñ‹Ñ….
- **Precision**: Ð”Ð¾Ð»Ñ Ñ†ÐµÐ»ÐµÐ²Ñ‹Ñ… IP ÑÑ€ÐµÐ´Ð¸ Ð²ÑÐµÑ… Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ…. Ð§ÐµÐ¼ Ð²Ñ‹ÑˆÐµ, Ñ‚ÐµÐ¼ Ð»ÑƒÑ‡ÑˆÐµ.
- **Rule Efficiency**: Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ†ÐµÐ»ÐµÐ²Ñ‹Ñ… IP Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¾. Ð’Ñ‹ÑˆÐµ = Ð»ÑƒÑ‡ÑˆÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð».
- **False Positive Rate**: Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð»Ð¾Ð¶Ð½Ð¾Ð³Ð¾ ÑÑ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ. ÐžÑ‡ÐµÐ½ÑŒ Ð¼Ð°Ð»Ð° Ð´Ð»Ñ IPv4.

## Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### ÐžÑˆÐ¸Ð±ÐºÐ°: "PuLP Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ PuLP. Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¾:
```bash
pip install pulp
```

### ILP Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑ‚ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¶Ð°Ð´Ð½Ñ‹Ð¹ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ (`-m greedy`)
- Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· `--max-prefix`
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¼ÐµÐ½ÑŒÑˆÐ¸Ð¹ `--max-entries`

### ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
- Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ `--max-entries`
- ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¼ÐµÑ‚Ð¾Ð´ `density`
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹

- ÐŸÐ¾Ð»Ð½Ð°Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ: `README.md`
- ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…: `example_ips.txt`
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ‚Ð¾Ñ€ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…: `generate_test_data.py`

